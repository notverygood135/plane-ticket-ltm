<!DOCTYPE html>
<html>
    <body>
        <div id="manage">
            <a href="http://localhost:8001/mangage/flights">home</a>
            <a href="http://localhost:8001/manage/flights">flights</a>
            <ul id="users"></ul>
        </div>
    </body>
    <script>
        const username = localStorage.getItem("username");
        let users = [];

        if (username != "admin") {
            const manage = document.getElementById("manage");
            manage.innerText = "";
            window.location.replace('http://localhost:8001')
        }

        fetch("/users", {
            method: "GET",
        })
        .then(response => {
            return(response.text());
        })
        .then(data => {
            users = JSON.parse(data);
            const ul = document.getElementById("users");
            ul.innerHTML = ""; // xoa cac element da co de them tu dau
            users.forEach(user => {
                const li = document.createElement("li");
                li.className = "user";

                const username = document.createElement("span");
                username.textContent = user.username;

                const type = document.createElement("span");
                if (user.type == "1") {
                    type.textContent = "Admin";
                }

                li.appendChild(username);
                li.appendChild(type);

                const changeType = document.createElement("button");
                changeType.addEventListener("click", e => {
                    const newType = user.type == "1" ? "0" : "1";
                    fetch('/users', {
                        method: "PUT",
                        headers: {
                            "Content-Type": "text/html"
                        },
                        body: `username=${user.username}&type=${newType}`
                    })
                    .then(response => {
                        return response.status;
                    })
                    .then(status => {
                        if (status == 200) {
                            alert("User updated successfully");
                            window.location.reload();
                        }
                        else {
                            alert("Error");
                        }
                    });
                });
                changeType.innerText = "Make admin";

                const deleteUser = document.createElement("button");
                deleteUser.addEventListener("click", e => {
                    fetch(`/users/${user.username}`, {
                        method: "DELETE",
                    })
                    .then(response => {
                        return response.status;
                    })
                    .then(status => {
                        if (status == 200) {
                            alert("User deleted successfully");
                            window.location.reload();
                        }
                        else {
                            alert("Error");
                        }
                    });
                });
                deleteUser.innerText = "Delete";
                li.appendChild(changeType);
                li.appendChild(deleteUser);
                ul.appendChild(li);
            });
        })
    </script>
</html>